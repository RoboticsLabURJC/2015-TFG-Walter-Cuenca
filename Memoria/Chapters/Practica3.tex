% Chapter ComecocosWeb

\chapter{Tienda Web} % Main chapter title
\section{Enunciado}
\subsection{Requisitos}
\subsubsection*{Apariencia}
\subsubsection*{Funcionalidad}
\subsection{Tecnologias Necesarias}
\begin{enumerate}
\item Django.
\item Tecnologias comunicacion cliente-servidor asincrono
\item WebServices
\item BBDD(Base de Datos)
\end{enumerate}
\subsection{Objetivos}
La aplicacion tiene que cumplir los siguientes caracteristicas:
\begin{enumerate}
\item EL proyecto tiene que contener varias: url's,modelos y vistas.
\item Gestion de usuarios : Login,Registro y Perfil individual
\item Utilizacion de contenido multimedia
\item Autocompletado.
\item Implemencion de webService
\item Carrito de la compra.
\item Formularios : validaciones y generacion.
\end{enumerate}
\section{Tecnologias aplicadas}
En este punto se explica los elementos que emplearemos de cada tecnologia en el desarrollo de esta practica.
\subsection{BBDD}
Para acceder/guardar informacion de los usuarios o del contenido de la web es necesario utilizar una BBDD com punto de almacenaiento de toda esta informacion.
\\Por lo general, cuando se genera una aplicacion con Django la BBDD que segenera es Sqlite3 ,en nuestro caso vamos a implementar Mysql al ser una de la BBDD mas utilizadas en este momento.
\\Por ello,necesitamos modificar el fichero 'setting' del proyeccto en el cual la informacion de  la BBDD que vamos a utilizar.
\begin{lstlisting}[
frame=single,
commentstyle=\color{CadetBlue},
captionpos=b,
caption=Conexion base de datos.]
 DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'prueba',
        'USER':'root',
        'PASSWORD':'*******',
        'HOST':'',
        'PORT':'',
    }
}
\end{lstlisting}
\subsection{Django}
Es un framework que nos permite desarrollar una aplicacion web de una forma ordenada y secilla. Se basa en un MVC,es decir, modelo-vista-controlador que son las principales puntos en los que se basa el framework.
\subsubsection{Models}
Los modelos se representan como una clase Python ya que nos permite expresar de la misma forma multiples motores de bases de datos.
\\Cada objeto se basa en el objeto 'models.Model' que contienen todas las herramientas necesarias para hacer que estos objetos interactuen con la base de datos de forma compacta.
\begin{lstlisting}[
frame=single,
commentstyle=\color{CadetBlue},
captionpos=b,
caption=Ejemplo de un Modelo.]

 from django.db import models
 
 class Artista(models.Model):
  name = models.CharField(max_length=100,null=True)
  linkImg = models.ImageField(upload_to="img_artist/",null=True)
  genero = models.CharField(max_length=100,null=True)
  web = models.URLField(max_length=100,null=True)
  disco = models.ManyToManyField(disco)
  videos = models.ManyToManyField(Videos) 
  galeria = models.ManyToManyField(Imagenes)
  
  def __unicode__(self):
   return self.name
\end{lstlisting}
Para definir cada una de las propiedades utilizamos el objeto 'models.Model' de Django el cual informa al framework que se trata de un modelo y por tanto lo tiene que guardar en la base de datos.
\\El siguiente paso se definen cada una de las propiedades como el name,linkImg,genero,...el cual define el tipo de campo:
\begin{itemize}
\item models.CharField : permite definir texto.
\item models.UrlField : permite definir una url.
\item models.ImageField : permite define una imagen.Es necesesario definir donde localizar el contenido pasando el atributo 'upload\_to'.
\item models.DateTimeField : esto define fecha y hora.
\item models.ForeignKey : permite vincularse a otro modelo estableciendo una relacion 1 a 1.
\item models.ManyToManyField : permite vincularse a otro modelo con una relacion 1 a n.
\end{itemize}
Tras la creacion de los campos de cada clase se pueden definir funciones propias.En nuestro ejemplo utilizamos '\_\_unicode\_\_'  que devuelve el valor del campo nombre del objeto.
\\Generalmente cada uno de  las clases se convierte en una tabla de la base de datos aunque si el metodo posee una relacion muchos-a-muchos se crea una tabla auxiliar entre los modelos.
\\imagen de una tabla intermedia
\\Para generar las tablas es necesario incluir los modelos en el fichero 'manage.py'.
\\generacion de las tablas 
\subsubsection{Vistas}
Es uno de los punto mas importante ya que contiene toda la logica necesario para interactuar con la base de datos y devolver por lo general una pagina web con ayuda de pantillas que mas adelante se explicara su funcionamiento.
\\Las vistas se encuentran del archivo 'models.py' del proyecto.
\begin{lstlisting}[
frame=single,
commentstyle=\color{CadetBlue},
captionpos=b,
caption=Ejemplo de vistas.]
 from django.http import HttpResponse 

 def EventSelect(request,evento):
  event = Evento.objects.filter(name__startswith=evento)
  return render(request,'IndexEvent.html',{'event':event})
    
 def IndexView(request):
  list_video=Videos.objects.all()
  return render(request,'fullVideo.html',{'list_video':list_video})
\end{lstlisting}
Cada de las vistas se crean a traves de una funcion definida en pyton  en las que distinguimos dos tipos :
\begin{itemize}
\item Dinamicas : son aquellas que reciben un parametro adicional a traves de la url como por ejemplo la funcion 'def EventSelect(request,event)'.Esta funcion recibe el parametro event a traves de la url asociada a ella.
\item Estaticas : son aquellas que reciben solo como parametro la peticion a traves del parametro 'request' como por ejemplo la funcion 'def IndexView(request)'.
\end{itemize}
Con la informacion que recibe se realiza una consulta con la BBDD obteniendo la informacion requerida.A traves del metodo 'render(request,'doc.html',info)' que recibe como parametros la peticion,el nombre del documento html(plantilla) y la informacion de la consulta se consigue mostrar la informacion al usuario como una pagina web.

\subsubsection{Controlador}
En este modelo el controlador tiene como funcion seleccionar la vista que corresponde a la peticion del usuario.
\\Por ello al crear la aplicacion se genera el archivo 'urls.py' que contiene todas las direcciones disponibles.
\begin{lstlisting}[
frame=single,
commentstyle=\color{CadetBlue},
captionpos=b,
caption=Ejemplo de url's.]

 from django.conf.urls.defaults import patterns, url
 from .views import ....

 urlpatterns = patterns('',
 	url(r'^index/$',  views.MainPage),
	url(r'^eventos/(?P<evento>\w{1,50})/$',  views.EventSelect),
 )
\end{lstlisting}
Dentro de la vaiable 'urlpattern' se introducen las direcciones como una dupla con los siguientes parametros:
\begin{itemize}
\item path url : define el formato de la direccion.
\item vista : define el nombre de la vista que se ejecuta cuando se realiza una consulta al path asociado.
\end{itemize}
En nuestra aplicacion se define dos tipos de path como se explican a continuacion :
\begin{itemize}
\item Dinamincos : son aquellos que permiten definir un parametro dentro del path que influye en respuesta.
\\Del ejemplo anterio,el path '(r'\^ eventos/(?P<evento>\\w{1,50})/\$, ...)' define el nombre a traves de '?P<evento>' y el tipo y longitud a traves de la varible de 'w{1,50}',en nuestro caso es de tipo string con una longitud maxima de 50 caracteres.
\item Estaticos : son aquellas que siempre obtinen las misma respusta al acceder a ellas ya que no reciben ningun parametro.Del ejemplo anterior el path '(r'\^index/\$',...)' es de este tipo.
\end{itemize}
\subsubsection{Sistema Plantillas}
Una plantilla define rellenos y permite utilizar etiquetas de plantilla que indican como se debe de mostrar el documento.Por lo general, se utiliza para generar documentos HTML aunque se puede generar cualquier tipo de documento basado en texto.
\begin{lstlisting}[
frame=single,
commentstyle=\color{CadetBlue},
captionpos=b,
caption=Ejemplo plantilla .]
 <!DOCTYPE html>
 <html>
  <head>
   <title>Hora actual</title>
  </head>
  <body>
   <h1>Bienvenidos</h1>
    <p>Dia y hora actual: {{ fechahora\_actual }}</p>
    {% for cantante in evento.artistas.all %}
     <div>
      <a href="pulpitrock.jpg" class="thumbnail">{{cantante.name}}</p></a>
     </div>
    {% endfor %}
    {% block info %}
    {% endblock %}
  </body>    
</html>
 {% extends 'IndexApp.html' %}
	
\end{lstlisting}
La plantilla del ejemplo muestra las caracteristicas de las que se pueden llevar:
\begin{itemize}
\item El contenido encerrado entre \{\{ \}\} es una variable obtenida a partir de la vista correspondiente
\item El contenido encerrado entre \{\% \%\} hace referencia a las etiquetas de plantilla permitiendo dotar a las plantillas de algun mecanismo simple de programacion.
\end{itemize}
Se puede definir varias tipos de etiquetas y filtros disponibles en la creacion de las plantillas.
\\Definir por cada enlace un documeto HTML seria algo muy pesado y segun la complejidad del proyecto esto llega ser inviable por ello en Django existe la definicion de herencia.
\\Esta propiedad permite definir una plantilla base con secciones de codigos que marcan las diferencias entre las distintas paginas a traves de las siguienes etiquetas \{\% block seccion1 \%\} y  \{\% endblock \%\}.Las paginas hijas heredan la estructura del padre a a traves de  \{\% extends 'IndexApp.html' \%\} y pasamos a sobreescribir cada una de las secciones anteriores por el contenido correspondiente.
\subsection{Tecnologias comunicacion cliente-servidor}
Para establecer comunicacion entre el cliente-el servidor existen tecnologias quer permiten que el usuario interactue con el servidor ya sea solicitando,validando o guardando algun tipo de informacion. \\En nuestra practica vamos a utilizar las siguientes tres tecnologias.
\subsubsection*{Ajax}
Permite realizar peticiones asincronas al servidor,es decir,son peticiones que se encargan de realizar una consulta al servidor y el resultado se presenta en una seccion de la pagina dando lugar a no cargar la pagina entera para poder mostrar el nuevo contenido.
\\Existen multiples formas de integra Ajax ya se utilizando el objeto XHTML.... a traves de JavaScript o empleando Jquery que disponde de metodo \$.ajax(......).Por facilida se emplea Jquery ya que nos permite realizar la peticion y presentar su resultado de una forma mas sencilla.
\subsubsection*{Cookie}
Para guardar informacion de estado del usuario durante su instancia en la web es necesario emplear Cookies debido a que el protocolo Http  no es capas de guardar este tipo de informacion.
\\En nuestra aplicacion es necesario guardar la compra de los elementos de la web 
\subsubsection*{Formularios}
Tienen como funcion validar/guardar informacion que los usuarios.
\\Disponemos de dos tipos principales Get y Post.El metodo Get se utiliza para solicitar acceso a un terminado punto de la aplicacion por lo que el usuario recibe un formulario vacio , mientras que el metodo Post se utiliza cuando el usuario ha rellenado un formulario y es envia al servidor el cual obtendra cada uno  del los campos para ser validados y permitan al usuario el acceso.
\\En la aplicacion se utiliza esto para desarrollar los siguientes puntos:
\begin{enumerate}
\item Register,Login de usuarios.
\item Modificacion perfil de cada usuario.
\item Contacta para la peticion de informacion sobre la web
\end{enumerate}
\subsection{WebServices}
Son servidores externos que contienen informacion guardada en su BBDD.Generalemente, se realizan peticion a una direccion donde el cuerpo del mensaje tiene que tener la estructura predefinida por el WebServices.
\\El formato de los datos pueden ser Json o XML segun las caracteristicas del Servidor Web. 
\section{Desarrollo}
\subsection{Back-End}
Se Establecen las tablas y sus campos como paso principal de nuestra aplicacion.En nuestra aplicacion se define los siguientes modelos:
\begin{enumerate}
\item Canciones
\item Discos
\item Videos
\item Eventos
\end{enumerate}
A continuacion,se incluye estos modelos dentro del archivo 'manage.py' para ser visible en el adminitrador de Django.
\\imagen de esto
\\Tras esto necesitamos introducir elementos en cada uno de las tablas generadad.Podemos introducir los elementos a traves del interfz de Mysql aunque Django permite realizar esto a traves deñ interfaz del Administrador que es mucho mas sencillo e intuitivo.
\\imagen de esto
El siguiente paso es generar el conjunto de rutas de las que dispone la aplicacion permitiendo al usuario acceder al contenido correspondiente.
\\imagen urls
\\El ultimo paso es generar las funciones que interactuan con la BBDD generan el contenido que el usuario pida con cada peticion, a continuacion pasamos a explicar cada una de estas funciones individualmente.
\subsubsection*{Index Page}

\subsubsection*{Select Festival}

\subsubsection*{Select Cantante}

\subsubsection*{Imagenes}

\subsubsection*{Videos}

\subsubsection*{Gestion de usuarios}

\subsubsection*{Compra elementos}


que el usuario tendra acceso durante sue stancia en la web.
\subsection{Frond-End}
\section{Demostración}
