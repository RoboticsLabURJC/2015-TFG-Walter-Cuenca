<!DOCTYPE html>
<html>
<head>
	<title>Juego del Comecocos</title>
</head>
<body onload="load_img()">
 <canvas id="mycanvas" style="border:solid;">

 	<script type="text/javascript">
		var time;
 		
 		var coinImage;
 		var come = false;
 		var contador = 0;
		var _canvas = document.getElementById('mycanvas');
		_canvas.width = 500;
		_canvas.height = 500;
		var context = _canvas.getContext('2d');

		var doit_pacman = [{x:40,y:90},{x:40,y:70},{x:40,y:50},{x:20,y:80},{x:20,y:100},{x:20,y:120},{x:20,y:140}]

		var pacman = {
			position:{x:20,y:50},
			color:'silver',
			radio:8,
			speed:0.04,
			direccion:'x',
			const_x:1,
		};
	


		var	frut={next:true,x:100,y:21,width:10,height:20};
		var	frut2={x:50,y:70};

		

		function load_img (){
			coinImage = new Image();
			coinImage.src = "chompersprites.png";
			coinImage.onload= function(){
				pacman.width=64*5;
				pacman.height=0;
				add_event();
				time = setTimeout(nex_fruit(), 2000)
				var render = setInterval(draw_pacman,10);
			};
		}
	
		function draw_pacman(){
			context.clearRect(0, 0, _canvas.width, _canvas.height);
			for(var i=0;i< doit_pacman.length;i++){
				var doit = doit_pacman[i];
				context.beginPath();
      	context.arc(doit.x, doit.y, 2, 0, 2 * Math.PI, false);
      	context.fillStyle = 'green';
      	context.fill();
      	context.stroke(); 
			}

			draw_fruit();


			/*if(come == false){
				context.beginPath();
      	context.rect(frut.x, frut.y, frut.width, frut.height);
      	context.fillStyle = 'yellow';
      	context.fill();
			}else{
				var render_fruit = setTimeout(nex_fruit,15);
			}*/

			/*context.drawImage(coinImage,pacman.width,pacman.height,coinImage.width/14,coinImage.height/4,
												pacman.position.x,pacman.position.y,coinImage.width/14,coinImage.height/4);*/

      	if(pacman.direccion == 'x'){
      		pacman.position.x += pacman.speed;
    			if(pacman.const_x == 1){
    				pacman.width=32*11;
    				pacman.height=0;
    				pacman.const_x = 0;
    			}else{
    				pacman.width=32*10;
    				pacman.height=0;
    				pacman.const_x = 1;
    			}
      	}
      	if(pacman.direccion == '-x'){
  				pacman.position.x -= pacman.speed;
      		if(pacman.const_x == 1){	
    				pacman.width=32*10;
      			pacman.height=32*2;
    				pacman.const_x = 0;
    			}else{
    				pacman.width=32*11;
    				pacman.height=32*2;
    				pacman.const_x = 1;
    			}
      	}
      	if(pacman.direccion == 'y'){
      		pacman.position.y += pacman.speed;
      		if(pacman.const_x == 1){	
    				pacman.width=32*10;
      			pacman.height=32*1;
    				pacman.const_x = 0;
    			}else{
    				pacman.width=32*11;
    				pacman.height=32*1;
    				pacman.const_x = 1;
    			}
      	}
      	if(pacman.direccion == '-y'){
      		pacman.position.y -= pacman.speed;
      		if(pacman.const_x == 1){	
    				pacman.width=32*10;
      			pacman.height=32*3;
    				pacman.const_x = 0;
    			}else{
    				pacman.width=32*11;
    				pacman.height=32*3;
    				pacman.const_x = 1;
    			}
      	}
			
				hit_wall();   
		}

		function hit_wall(){
			if(pacman.position.x+pacman.radio > _canvas.width-10 || pacman.position.x-pacman.radio < 10 ){
				pacman.direccion = 'wall';
			}else if(pacman.position.y+pacman.radio > _canvas.height-10|| pacman.position.y-pacman.radio < 10 ){
				pacman.direccion = 'wall';
			}
		}

		function add_event(){
			var push_pacman = false;
			_canvas.addEventListener("mousedown", function(event){	
				var point_mouse = valor_mouse_real(event);	
				if(point_mouse.y<(pacman.position.y+coinImage.width/14) && point_mouse.y>(pacman.position.y-coinImage.width/14) ){
					if(point_mouse.x>(pacman.position.x+coinImage.width/14)){
						pacman.direccion = 'x';
					}else if(point_mouse.x<(pacman.position.x-coinImage.width/14)){
						pacman.direccion = '-x';
					}
				}else if(point_mouse.x>(pacman.position.x-coinImage.width/14) && point_mouse.x<(pacman.position.x+coinImage.width/14) ){
					if(point_mouse.y>(pacman.position.y+coinImage.width/14)){
						pacman.direccion = 'y';
					}else if(point_mouse.y<(pacman.position.y-coinImage.width/14)){
						pacman.direccion = '-y';
					}
				}

			},false);
		

			/*_canvas.addEventListener("mouseup",function(event){
				//console.log(push_pacman);
					if(push_pacman){
						var point_mouse = valor_mouse_real(event);
						eat_fruit(point_mouse);
						eai_doit(point_mouse);
						move_line(pacman.position,point_mouse);
					}
			});*/
		}


		/*function move_line(pos_actu,pos_new){
			var type_move;
				if(pos_new.y<(pos_actu.y+pacman.radio) && pos_new.y>(pos_actu.y-pacman.radio) ){
					if(pos_new.x>(pos_actu.x+pacman.radio)){
						pacman.position.x += 5;
					}else if(pos_new.x<(pos_actu.x-pacman.radio)){
						pacman.position.x -= 5;
					}
				}else if(pos_new.x>(pos_actu.x-pacman.radio) && pos_new.x<(pos_actu.x+pacman.radio) ){
					if(pos_new.y>(pos_actu.y+pacman.radio)){
						pacman.position.y += 5;
					}else if(pos_new.y<(pos_actu.y-pacman.radio)){
						pacman.position.y -= 5;
					}
				}
		}*/
		
		function draw_fruit(){
				context.beginPath();
      		context.arc(frut.x, frut.y, 4, 0, 2 * Math.PI, false);
      		context.fillStyle = 'black';
      		context.fill();
      		context.stroke();
    }

   
      

		function nex_fruit(){
			console.log("next_position");
			frut.x += 5;
			frut.y += 5;
		 	time = setTimeout(arguments.callee, 1000)
		 	console.log("eleminamos el Timeout;")
		}

		function eai_doit(position){
			for(var i=0;i<doit_pacman.length;i++){
				var doit = doit_pacman[i];
				if(position.y > doit.y-8 && position.y < doit.y+8){
					if(position.x > doit.x && position.x < doit.x+20){
						console.log("pacman come doit en x ");
						doit_pacman.splice(i, 1);
					}
				}else if(position.x>doit.x-8 && position.x < doit.x+8){
					if(position.y > doit.y && position.y < doit.y+20){
						console.log("pacman come doit en y ");
						doit_pacman.splice(i, 1);
					}	
				}
			}
		}


		function eat_fruit(position){
			if(position.x > frut.x && position.x < frut.x + frut.width){
				if(position.y > frut.y && position.y < frut.y + frut.height){
					console.log("pacman come");
					come = true;
				}
			}
		}

		

		function valor_mouse_real(event,canvas){
    	var rect = _canvas.getBoundingClientRect();
    	var coordenada = {};
    	coordenada.x = event.clientX - rect.left;
    	coordenada.y  = event.clientY - rect.top;
    	return  coordenada;
    }

		

	</script>

</body>
</html>

